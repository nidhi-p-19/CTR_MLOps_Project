name: ðŸ“Š Weekly Model Drift Monitor

on:
  schedule:
    - cron: "0 0 * * 1"   # Every Monday at midnight
  workflow_dispatch:       # Allow manual trigger

jobs:
  detect_drift:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Drift Detection
        id: drift_check
        run: |
          python monitor_drift.py > drift_output.txt || true
          if grep -q "DRIFT DETECTED" drift_output.txt; then
            echo "drift=true" >> $GITHUB_OUTPUT
          else
            echo "drift=false" >> $GITHUB_OUTPUT
          fi

      - name: Upload Drift Report
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: drift-report
          path: reports/

      - name: Trigger MLOps Retraining Pipeline
        if: steps.drift_check.outputs.drift == 'true'
        uses: benc-uk/workflow-dispatch@v1
        with:
          workflow: mlops.yml
          token: ${{ secrets.GITHUB_TOKEN }}
